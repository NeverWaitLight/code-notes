# Story 1.1: 项目骨架与基础配置

## Status

Done

## Story

**As a** 开发者,
**I want** 初始化后端工程与本地存储/数据库配置，
**so that** 项目可以本机启动并具备最小运行基础。

## Epic Context

Epic 1 目标是完成“基础架构与上传处理闭环”。本 Story 建立后端工程骨架、本地存储与数据库配置，为后续上传、分片与列表接口等故事提供运行基础。[Source: docs/prd/epic-1-基础架构与上传处理闭环.md#epic-1-基础架构与上传处理闭环]

## Dependencies

无前置 Story 依赖。

## Acceptance Criteria

1. 后端为 Spring Boot + Maven 项目，可在本机启动运行。
2. SQLite 连接配置完成，应用可在指定路径创建数据库文件。
3. 视频与 HLS 输出目录可配置，启动时若目录不存在会自动创建。
4. 根目录包含 `backend/` 与 `frontend/` 两个独立目录结构。
5. 根目录提供 `startup.sh` 脚本，可启动后端；若存在前端目录与依赖，则可同时启动前端（开发模式）。

## Tasks / Subtasks

- [x] Task 1 初始化后端 Spring Boot + Maven 工程于 `backend/`，Java 21 / Spring Boot 3.2.x（AC:1,4）[Source: docs/architecture/introduction.md#starter-template-or-existing-project][Source: docs/architecture/tech-stack.md#tech-stack][Source: docs/architecture/high-level-architecture.md#repository-structure]
  - [x] Subtask 1.1 使用 Spring Initializr 生成基础项目骨架与 `pom.xml`（AC:1）[Source: docs/architecture/introduction.md#starter-template-or-existing-project]
  - [x] Subtask 1.2 确认 `backend/src/main/java/com/example/videodemo/` 与 `backend/src/main/resources/` 目录落位（AC:1）[Source: docs/architecture/unified-project-structure.md#unified-project-structure]
- [x] Task 2 初始化前端目录 `frontend/`（AC:4）[Source: docs/architecture/introduction.md#starter-template-or-existing-project][Source: docs/architecture/unified-project-structure.md#unified-project-structure]
  - [x] Subtask 2.1 使用 Vite `create-vue` 创建 Vue 3 项目骨架，并选择 TypeScript（5.4.x）（AC:4）[Source: docs/architecture/introduction.md#starter-template-or-existing-project][Source: docs/architecture/tech-stack.md#关键选型与推荐请确认]
- [x] Task 3 配置本地存储与目录创建（AC:3）[Source: docs/architecture/development-workflow.md#environment-configuration][Source: docs/architecture/unified-project-structure.md#unified-project-structure]
  - [x] Subtask 3.1 引入 `APP_STORAGE_ROOT=./data/videos` 并在启动时确保目录存在（AC:3）[Source: docs/architecture/development-workflow.md#environment-configuration]
- [x] Task 4 配置 SQLite 连接与数据库文件路径（AC:2）[Source: docs/architecture/backend-architecture.md#sqlite-compatibility][Source: docs/architecture/development-workflow.md#environment-configuration]
  - [x] Subtask 4.1 配置 `APP_DB_PATH=./data/app.db` 与 SQLite 方言/驱动（AC:2）[Source: docs/architecture/backend-architecture.md#sqlite-compatibility][Source: docs/architecture/development-workflow.md#environment-configuration]
- [x] Task 5 添加根目录 `startup.sh` 启动脚本（AC:5）[Source: docs/architecture/development-workflow.md#development-commands][Source: docs/architecture/development-workflow.md#development-workflow]
  - [x] Subtask 5.1 脚本支持启动后端（`mvn spring-boot:run`）；如前端存在则启动 `npm run dev -- --port 5173`（开发模式）（AC:5）[Source: docs/architecture/development-workflow.md#development-commands]
- [x] Task 6 基础测试与验证（AC:1,2,3）[Source: docs/architecture/testing-strategy.md#testing-strategy][Source: docs/architecture/local-validation.md#local-validation]
  - [x] Subtask 6.1 添加后端基础测试（Spring Boot Test/JUnit 5）并放在 `backend/src/test/java/com/example/videodemo/`（AC:1）[Source: docs/architecture/testing-strategy.md#test-organization]
  - [x] Subtask 6.2 运行本地验证：启动后端并确认 `data/app.db`、`data/videos/` 创建（AC:2,3）[Source: docs/architecture/local-validation.md#jpa-sqlite]

## Dev Notes

### Previous Story Insights

No specific guidance found in architecture docs

### Data Models

No specific guidance found in architecture docs

### API Specifications

No specific guidance found in architecture docs

### Component Specifications

No specific guidance found in architecture docs

### File Locations

- `backend/` 与 `frontend/` 并列，允许 `docs/` 与 `data/` 目录；根目录包含 `startup.sh`。[Source: docs/architecture/unified-project-structure.md#unified-project-structure]
- 后端包路径建议 `backend/src/main/java/com/example/videodemo/`，资源在 `backend/src/main/resources/`。[Source: docs/architecture/unified-project-structure.md#unified-project-structure]
- 后端配置类可放在 `backend/src/main/java/com/example/videodemo/config/`。[Source: docs/architecture/backend-architecture.md#controllerroute-organization]

### Configuration

- SQLite 配置示例（application.yml）：[Source: docs/architecture/backend-architecture.md#sqlite-compatibility]

```yaml
spring:
  jpa:
    database-platform: org.hibernate.community.dialect.SQLiteDialect
    hibernate:
      ddl-auto: update
  datasource:
    url: jdbc:sqlite:${APP_DB_PATH}
    driver-class-name: org.sqlite.JDBC
```

- 相关环境变量：`APP_STORAGE_ROOT=./data/videos`、`APP_DB_PATH=./data/app.db`。[Source: docs/architecture/development-workflow.md#required-environment-variables]
- 资源目录位于 `backend/src/main/resources/`。[Source: docs/architecture/unified-project-structure.md#unified-project-structure]

### Dependencies

- SQLite 方言与驱动：`hibernate-community-dialects (SQLiteDialect) 6.4.2.Final`、`sqlite-jdbc 3.45.2.0`。[Source: docs/architecture/tech-stack.md#technology-stack-table]

### Testing

- 后端测试目录：`backend/src/test/java/com/example/videodemo/`；使用 JUnit 5 + Spring Boot Test。[Source: docs/architecture/testing-strategy.md#test-organization]
- 仅需 Unit + Integration + 手工冒烟，不引入 E2E。[Source: docs/architecture/tech-stack.md#关键选型与推荐请确认]

### Technical Constraints

- 后端技术栈：Java 21、Spring Boot 3.2.x、Maven、SQLite、Spring Data JPA。[Source: docs/architecture/tech-stack.md#technology-stack-table]
- 前端语言建议 TypeScript 5.4.x。[Source: docs/architecture/tech-stack.md#关键选型与推荐请确认]
- 本地存储与数据库路径通过配置读取：`APP_STORAGE_ROOT=./data/videos`、`APP_DB_PATH=./data/app.db`。[Source: docs/architecture/development-workflow.md#required-environment-variables]
- 存储路径不得硬编码。[Source: docs/architecture/coding-standards.md#critical-fullstack-rules]

## Project Structure Notes

- 与 `Unified Project Structure` 对齐：需要 `backend/`、`frontend/`、`data/`、`docs/` 及 `startup.sh`。[Source: docs/architecture/unified-project-structure.md#unified-project-structure]

## Change Log

| Date       | Version | Description                                  | Author |
| ---------- | ------- | -------------------------------------------- | ------ |
| 2026-01-15 | v0.1    | 创建 Story 1.1 草稿                          | Bob    |
| 2026-01-15 | v0.2    | 补充 TypeScript 选择、配置示例与启动脚本细节 | Sarah  |
| 2026-01-15 | v0.3    | 完成骨架搭建、配置与验证                     | James  |

## Dev Agent Record

### Agent Model Used
GPT-5 (Codex)

### Debug Log References
- `mvn -f backend/pom.xml test`

### Completion Notes List
- 后端使用 Spring Boot 3.2.2 + Java 21，SQLite 方言与驱动已配置。
- `app.storage-root` 与 `app.db-path` 默认指向 `../data`，启动前自动创建目录与数据库文件。
- 前端用 `create-vue` 初始化并锁定 TypeScript 5.4.x。

### File List
- backend/.mvn/wrapper/maven-wrapper.properties
- backend/HELP.md
- backend/mvnw
- backend/mvnw.cmd
- backend/pom.xml
- backend/src/main/java/com/example/videodemo/VideodemoApplication.java
- backend/src/main/java/com/example/videodemo/config/StoragePathInitializer.java
- backend/src/main/resources/application.yml
- backend/src/test/java/com/example/videodemo/VideodemoApplicationTests.java
- backend/src/main/resources/application.properties (deleted)
- frontend/README.md
- frontend/env.d.ts
- frontend/index.html
- frontend/package.json
- frontend/public/favicon.ico
- frontend/src/App.vue
- frontend/src/assets/base.css
- frontend/src/assets/logo.svg
- frontend/src/assets/main.css
- frontend/src/components/HelloWorld.vue
- frontend/src/components/TheWelcome.vue
- frontend/src/components/WelcomeItem.vue
- frontend/src/components/icons/IconCommunity.vue
- frontend/src/components/icons/IconDocumentation.vue
- frontend/src/components/icons/IconEcosystem.vue
- frontend/src/components/icons/IconSupport.vue
- frontend/src/components/icons/IconTooling.vue
- frontend/src/main.ts
- frontend/tsconfig.app.json
- frontend/tsconfig.json
- frontend/tsconfig.node.json
- frontend/vite.config.ts
- startup.sh

## QA Results

- 2026-01-15 结论: CONCERNS
- AC3 “视频与 HLS 输出目录可配置且启动时创建”未完全落实：仅存在 `app.storage-root`，缺少独立 HLS 输出目录配置/初始化逻辑（`backend/src/main/resources/application.yml:1`、`backend/src/main/java/com/example/videodemo/config/StoragePathInitializer.java:24`）。
- 任务列表存在重复的 Task 1（`docs/stories/1.1.story.md:31` 与 `docs/stories/1.1.story.md:32`），影响状态一致性与可追溯性。
- 验证: `mvn -f backend/pom.xml test`

- 2026-01-15 复查结论: PASS
- AC3 已补齐：新增 `app.hls-root` 配置并在启动时创建目录（`backend/src/main/resources/application.yml:1`、`backend/src/main/java/com/example/videodemo/config/StoragePathInitializer.java:24`）。
- 任务列表重复的 Task 1 已清理，状态一致。
- 验证: `mvn -f backend/pom.xml test`

Gate: PASS → docs/qa/gates/1.1-project-skeleton-and-basic-config.yml
