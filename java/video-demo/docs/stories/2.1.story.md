# Story 2.1: 前端基础框架与列表页

## Status

Done

## Story

**As a** 访客,
**I want** 打开首页即可查看视频列表,
**so that** 可以快速进入播放体验。

## Epic Context

Epic 2 目标是实现三页前端与基本交互，包括列表、上传进度、播放与删除操作，形成可演示的完整体验。本 Story 负责前端基础框架搭建与列表页实现，为后续上传与播放功能提供基础。[Source: docs/prd/epic-2-前端体验与播放删除.md#epic-2-前端体验与播放删除]

## Dependencies

依赖 Story 1.2 已完成上传接口与列表查询接口。

## Acceptance Criteria

1. 使用 Vue 3 + Vite 创建前端项目，位于 `frontend/` 目录。
2. 配置路由：列表页（/）、上传页（/upload）、播放页（/play/:id）。
3. 列表页调用后端列表接口并展示标题与状态。
4. 点击列表项可进入对应播放页。

## Tasks / Subtasks

- [x] Task 1 初始化前端项目结构（AC:1）[Source: docs/architecture/unified-project-structure.md#unified-project-structure][Source: docs/architecture/tech-stack.md#technology-stack-table]
  - [x] Subtask 1.1 在 `frontend/` 目录创建 Vue 3 + Vite + TypeScript 项目，使用 `npm create vue@latest` 或手动配置（AC:1）[Source: docs/architecture/tech-stack.md#technology-stack-table]
  - [x] Subtask 1.2 安装依赖：Vue 3.4.15、Pinia 2.1.7、Vue Router 4.x、TypeScript 5.4.2（AC:1）[Source: docs/architecture/tech-stack.md#technology-stack-table]
  - [x] Subtask 1.3 配置 Vite：设置开发服务器端口为 5173，配置代理或环境变量 `VITE_API_BASE=http://localhost:8080`（AC:1）[Source: docs/architecture/frontend-architecture.md#api-client-setup]
  - [x] Subtask 1.4 创建基础目录结构：`src/pages/`、`src/components/`、`src/services/`、`src/stores/`、`src/router/`、`src/types/`（AC:1）[Source: docs/architecture/frontend-architecture.md#component-organization]
- [x] Task 2 配置路由系统（AC:2）[Source: docs/architecture/frontend-architecture.md#routing-architecture]
  - [x] Subtask 2.1 创建 `src/router/index.ts`，使用 `createRouter` 和 `createWebHistory`（AC:2）[Source: docs/architecture/frontend-architecture.md#routing-architecture]
  - [x] Subtask 2.2 定义路由：`/` 映射到 VideoListPage，`/upload` 映射到 UploadPage，`/play/:id` 映射到 PlayerPage（AC:2）[Source: docs/architecture/frontend-architecture.md#routing-architecture]
  - [x] Subtask 2.3 在 `main.ts` 中注册 router，配置无鉴权路由守卫（直接放行）（AC:2）[Source: docs/architecture/frontend-architecture.md#routing-architecture]
- [x] Task 3 实现 API 客户端与服务层（AC:3）[Source: docs/architecture/frontend-architecture.md#frontend-services-layer]
  - [x] Subtask 3.1 创建 `src/services/apiClient.ts`，实现基础请求函数，使用 `VITE_API_BASE` 环境变量，错误处理返回 `{ error: { code, message } }` 格式（AC:3）[Source: docs/architecture/frontend-architecture.md#api-client-setup][Source: docs/architecture/error-handling-strategy.md#error-response-format]
  - [x] Subtask 3.2 创建 `src/services/videoService.ts`，实现 `list()` 方法调用 `GET /api/videos`，返回 `Video[]` 类型（AC:3）[Source: docs/architecture/frontend-architecture.md#service-example][Source: docs/architecture/api-specification.md#endpoint-details]
  - [x] Subtask 3.3 创建 `src/types/video.ts` 和 `src/types/api.ts`，定义 Video 和 ApiError 类型接口（AC:3）[Source: docs/architecture/data-models.md#video][Source: docs/architecture/error-handling-strategy.md#error-response-format]
- [x] Task 4 实现状态管理（AC:3）[Source: docs/architecture/frontend-architecture.md#state-management-architecture]
  - [x] Subtask 4.1 创建 `src/stores/videoStore.ts`，使用 Pinia `defineStore`，定义 state：`items: Video[]`、`loading: boolean`、`error?: ApiError`（AC:3）[Source: docs/architecture/frontend-architecture.md#state-management-architecture]
  - [x] Subtask 4.2 实现 `fetchList()` action，调用 `videoService.list()`，更新 state 和错误处理（AC:3）[Source: docs/architecture/frontend-architecture.md#state-management-architecture]
- [x] Task 5 实现列表页组件（AC:3,4）[Source: docs/architecture/frontend-architecture.md#component-organization]
  - [x] Subtask 5.1 创建 `src/pages/VideoListPage.vue`，使用 Composition API `<script setup lang="ts">`（AC:3,4）[Source: docs/architecture/frontend-architecture.md#component-template]
  - [x] Subtask 5.2 在组件中调用 `useVideoStore().fetchList()`，展示 loading、error、空态（`暂无视频，去上传一个吧`）和列表数据（AC:3）[Source: docs/architecture/frontend-architecture.md#ui-状态与文案][Source: docs/architecture/frontend-architecture.md#state-management-patterns]
  - [x] Subtask 5.3 列表项展示：视频标题（`video.title`）和状态（`video.status`），状态显示为中文：UPLOADING=上传中、READY=上传完成、FAILED=失败（AC:3）[Source: docs/architecture/frontend-architecture.md#ui-状态与文案]
  - [x] Subtask 5.4 为每个列表项添加点击事件，使用 `router.push('/play/' + video.id)` 跳转到播放页（AC:4）[Source: docs/architecture/frontend-architecture.md#routing-architecture]
- [x] Task 6 创建占位页面组件（AC:2）[Source: docs/architecture/frontend-architecture.md#component-organization]
  - [x] Subtask 6.1 创建 `src/pages/UploadPage.vue` 占位页面，仅显示"上传页"标题（AC:2）
  - [x] Subtask 6.2 创建 `src/pages/PlayerPage.vue` 占位页面，仅显示"播放页"标题和视频 ID（AC:2）
- [x] Task 7 测试与验证（AC:1,2,3,4）[Source: docs/architecture/testing-strategy.md#testing-strategy]
  - [x] Subtask 7.1 启动前端开发服务器（`npm run dev`），验证路由跳转正常（AC:2）[Source: docs/architecture/testing-strategy.md#test-organization]
  - [x] Subtask 7.2 验证列表页能正确调用后端接口并展示数据（AC:3）[Source: docs/architecture/testing-strategy.md#test-organization]
  - [x] Subtask 7.3 验证点击列表项能跳转到播放页（AC:4）[Source: docs/architecture/testing-strategy.md#test-organization]
  - [x] Subtask 7.4 手工冒烟测试：验证空态、加载态、错误态显示正确（AC:3）[Source: docs/architecture/testing-strategy.md#testing-strategy]

## Dev Notes

### Previous Story Insights

- 前端项目基础结构已存在：`frontend/` 目录已包含 Vue 3 项目基础结构（package.json、vite.config.ts、src/main.ts 等），但依赖不完整，当前仅安装 Vue 3.5.26，缺少 Pinia、Vue Router 等必需依赖。[Source: frontend/package.json]
- 实现时需先执行 Task 1.2 安装缺失依赖：Pinia 2.1.7、Vue Router 4.x 等，然后继续后续任务。
- 本 Story 是前端第一个实现，不依赖前序前端实现。

### Data Models

- Video 类型接口：`id: number`、`title: string`、`status: "UPLOADING" | "READY" | "FAILED"`、`sizeBytes: number`、`createdAt: number`。[Source: docs/architecture/data-models.md#video]
- 列表接口返回 `VideoListItemDto[]`，包含 id、title、status、sizeBytes、createdAt 字段。[Source: docs/architecture/api-specification.md#endpoint-details]
- 状态枚举值：UPLOADING（上传中）、READY（上传完成）、FAILED（失败）。[Source: docs/architecture/data-models.md#video]

### API Specifications

- `GET /api/videos` 返回视频列表，支持分页参数 `page`（默认 0）和 `size`（默认 50），返回 `VideoListItemDto[]`。[Source: docs/architecture/api-specification.md#endpoint-details]
- API 基础地址：开发环境使用 `http://localhost:8080`，通过环境变量 `VITE_API_BASE` 配置。[Source: docs/architecture/frontend-architecture.md#api-client-setup]
- 错误响应格式：`{ error: { code: string, message: string } }`，前端需统一处理。[Source: docs/architecture/error-handling-strategy.md#error-response-format]

### Component Specifications

- 页面组件位置：`src/pages/VideoListPage.vue`、`src/pages/UploadPage.vue`、`src/pages/PlayerPage.vue`。[Source: docs/architecture/frontend-architecture.md#component-organization]
- 组件使用 Vue 3 Composition API，`<script setup lang="ts">` 语法。[Source: docs/architecture/frontend-architecture.md#component-template]
- 状态管理使用 Pinia，所有异步调用通过 store actions 统一管理，UI 仅消费 store 状态。[Source: docs/architecture/frontend-architecture.md#state-management-patterns]

### File Locations

- 前端项目根目录：`frontend/`。[Source: docs/architecture/unified-project-structure.md#unified-project-structure]
- 源代码目录：`frontend/src/`，包含 `pages/`、`components/`、`services/`、`stores/`、`router/`、`types/`。[Source: docs/architecture/frontend-architecture.md#component-organization]
- 入口文件：`frontend/src/main.ts`，配置文件：`frontend/vite.config.ts`、`frontend/package.json`。[Source: docs/architecture/unified-project-structure.md#unified-project-structure]

### Configuration

- 开发服务器端口：前端使用 5173（Vite 默认），后端使用 8080，避免端口冲突。[Source: docs/architecture/frontend-architecture.md#api-client-setup]
- 环境变量：`VITE_API_BASE=http://localhost:8080`，在 `.env` 或 `vite.config.ts` 中配置。[Source: docs/architecture/frontend-architecture.md#api-client-setup]
- 构建工具：Vite 5.1.4，使用 TypeScript 5.4.2。[Source: docs/architecture/tech-stack.md#technology-stack-table]
- **当前项目状态**：`frontend/` 目录已存在基础 Vue 3 项目结构，但依赖不完整。Task 1.1 需检查现有结构，Task 1.2 需补充安装 Pinia、Vue Router 等缺失依赖。[Source: frontend/package.json]

### Testing

- 前端测试目录：`frontend/src/` 或 `frontend/tests/`（根据项目配置）；使用 Vitest + Vue Test Utils。[Source: docs/architecture/tech-stack.md#technology-stack-table]
- 测试策略：仅需 Unit + Integration + 手工冒烟，不引入 E2E。[Source: docs/architecture/tech-stack.md#关键选型与推荐请确认]
- 手工冒烟测试：验证路由跳转、列表加载、错误处理等基本功能。[Source: docs/architecture/testing-strategy.md#testing-strategy]

### Technical Constraints

- 前端技术栈：Vue 3.4.15 + TypeScript 5.4.2 + Vite 5.1.4 + Pinia 2.1.7 + Vue Router 4.x。[Source: docs/architecture/tech-stack.md#technology-stack-table]
- 不使用 UI 组件库，保持轻量，自行实现基础样式。[Source: docs/architecture/tech-stack.md#technology-stack-table]
- 错误处理：所有 API 调用需捕获错误并统一展示，使用 store 的 error 状态管理。[Source: docs/architecture/frontend-architecture.md#state-management-architecture]
- 路由无鉴权需求，直接放行所有路由。[Source: docs/architecture/frontend-architecture.md#routing-architecture]

## Project Structure Notes

- 与 `Unified Project Structure` 对齐：`frontend/` 目录已存在，需在内部创建完整的 Vue 3 项目结构。[Source: docs/architecture/unified-project-structure.md#unified-project-structure]
- 前端项目需独立运行，通过 API 调用后端服务，不直接访问后端文件系统或数据库。[Source: docs/architecture/components.md#component-diagrams]

## Change Log

| Date       | Version | Description                                                  | Author |
| ---------- | ------- | ------------------------------------------------------------ | ------ |
| 2026-01-15 | v0.3    | 根据 QA 意见改进代码 添加测试覆盖 改进错误处理 优化路由守卫  | James  |
| 2026-01-15 | v0.2    | 验证通过，补充项目状态说明，状态更新为 Ready for Development | Sarah  |
| 2026-01-15 | v0.1    | 创建 Story 2.1 草稿                                          | Bob    |

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5

### Debug Log References

npm run dev - 前端开发服务器已启动在端口 5173
npm run test:run - 所有测试通过 20 个测试全部通过

### Completion Notes List

已完成前端基础框架与列表页实现
创建了完整的目录结构 pages components services stores router types
配置了 Vue Router 路由系统 包含列表页上传页播放页三个路由
实现了 API 客户端 apiClient 使用 VITE_API_BASE 环境变量
实现了视频服务 videoService 提供 list 方法调用后端接口
创建了类型定义 Video 和 ApiError 接口
实现了 Pinia 状态管理 videoStore 包含 items loading error 状态
实现了列表页组件 VideoListPage 展示视频列表和状态
实现了状态中文显示 UPLOADING 上传中 READY 上传完成 FAILED 失败
实现了列表项点击跳转到播放页功能
创建了上传页和播放页占位组件
配置了 Vite 开发服务器端口为 5173
更新了 main.ts 注册 Pinia 和 Router
更新了 App.vue 使用 RouterView 渲染路由组件
根据 QA 意见进行了改进
改进了 apiClient 错误处理 支持非 JSON 格式响应和网络错误处理
优化了路由守卫 移除了不必要的 beforeEach 添加了注释说明
添加了完整的测试覆盖 包括 apiClient videoService videoStore VideoListPage 的单元测试和集成测试
配置了 Vitest 测试环境 添加了测试脚本到 package.json

### File List

frontend/src/types/api.ts - API 错误类型定义
frontend/src/types/video.ts - Video 类型定义
frontend/src/services/apiClient.ts - API 客户端实现
frontend/src/services/videoService.ts - 视频服务实现
frontend/src/stores/videoStore.ts - Pinia 状态管理
frontend/src/router/index.ts - 路由配置
frontend/src/pages/VideoListPage.vue - 列表页组件
frontend/src/pages/UploadPage.vue - 上传页占位组件
frontend/src/pages/PlayerPage.vue - 播放页占位组件
frontend/src/main.ts - 更新注册 Pinia 和 Router
frontend/src/App.vue - 更新使用 RouterView
frontend/vite.config.ts - 配置开发服务器端口和测试环境
frontend/src/services/apiClient.ts - 改进错误处理支持非 JSON 响应
frontend/src/router/index.ts - 优化路由守卫添加注释
frontend/tests/services/apiClient.test.ts - API 客户端测试
frontend/tests/services/videoService.test.ts - 视频服务测试
frontend/tests/stores/videoStore.test.ts - 状态管理测试
frontend/tests/pages/VideoListPage.test.ts - 列表页组件测试
frontend/package.json - 添加测试脚本

## QA Results

### Review Date: 2026-01-15

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

代码实现质量良好，结构清晰，遵循 Vue 3 Composition API 最佳实践。所有核心功能已正确实现，类型定义完整，错误处理基本到位。代码组织符合项目架构要求，目录结构清晰，组件职责明确。

### Refactoring Performed

未执行重构。代码质量已达到可接受水平，当前实现符合项目标准。

### Compliance Check

- Coding Standards: ✓ 符合编码规范，使用 PascalCase 命名组件，遵循 TypeScript 类型定义要求
- Project Structure: ✓ 完全符合统一项目结构，frontend/ 目录结构正确
- Testing Strategy: ✗ 缺少测试文件，根据测试策略应使用 Vitest + Vue Test Utils 进行单元测试和集成测试
- All ACs Met: ✓ 所有验收标准均已实现并验证

### Improvements Checklist

- [ ] 添加前端单元测试：为 VideoListPage、videoStore、videoService 等核心组件和服务添加测试
- [ ] 添加集成测试：验证 API 调用和状态管理集成
- [ ] 改进 apiClient 错误处理：当响应不是 JSON 格式时添加更健壮的错误处理
- [ ] 优化路由守卫：router.beforeEach(() => true) 可以改为更明确的实现方式

### Security Review

无安全风险。前端无鉴权需求，符合故事要求。API 调用使用环境变量配置，无硬编码敏感信息。

### Performance Considerations

性能表现良好。列表页实现简洁，无性能瓶颈。状态管理使用 Pinia，响应式更新高效。路由使用懒加载，符合最佳实践。

### Files Modified During Review

本次审查未修改任何代码文件。

### Gate Status

Gate: CONCERNS → docs/qa/gates/2.1-前端基础框架与列表页.yml

### Recommended Status

✗ Changes Required - 建议在添加测试覆盖后再标记为 Done。虽然功能实现完整，但缺少测试会影响代码的可维护性和回归测试能力。

---

### Review Date: 2026-01-15 (Re-review)

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

代码质量优秀。开发团队已根据首次审查意见完成了所有改进。测试覆盖完整，错误处理健壮，代码符合最佳实践。所有验收标准均已实现并通过测试验证。

### Refactoring Performed

未执行重构。代码质量已达到优秀水平。

### Compliance Check

- Coding Standards: ✓ 完全符合编码规范
- Project Structure: ✓ 完全符合统一项目结构
- Testing Strategy: ✓ 已添加完整的测试覆盖，使用 Vitest + Vue Test Utils，共 20 个测试全部通过
- All ACs Met: ✓ 所有验收标准均已实现并验证

### Improvements Checklist

- [x] 添加前端单元测试：已为 VideoListPage、videoStore、videoService、apiClient 添加完整测试覆盖（20 个测试全部通过）
- [x] 添加集成测试：测试覆盖了 API 调用和状态管理集成场景
- [x] 改进 apiClient 错误处理：已支持非 JSON 格式响应、网络错误、空文本响应等多种错误场景
- [x] 优化路由守卫：已移除不必要的 beforeEach，添加了清晰的注释说明

### Security Review

无安全风险。前端无鉴权需求，符合故事要求。API 调用使用环境变量配置，无硬编码敏感信息。

### Performance Considerations

性能表现优秀。列表页实现简洁高效，无性能瓶颈。状态管理使用 Pinia，响应式更新高效。路由使用懒加载，符合最佳实践。

### Files Modified During Review

本次审查未修改任何代码文件。所有改进已由开发团队完成。

### Gate Status

Gate: PASS → docs/qa/gates/2.1-前端基础框架与列表页.yml

### Recommended Status

✓ Ready for Done - 所有改进已完成，测试覆盖完整，代码质量优秀，可以标记为 Done。
